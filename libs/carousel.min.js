/**
 * Carousel Library
 *  - create a carousel with different effect
 *
 * Author: Jean-Christophe HAUTREUX
 * Version: 1.0
 */
var Carousel=function(){};Carousel.create=function(e,t,n){var r=false;if(n==undefined){n=Carousel.getLibraryClass();r=Carousel.create(e,t,n)}else{r=new n.prototype.constructor;if(r instanceof Carousel)r.construct(e,t)}return r};Carousel.detectUsedLibrary=function(){if(typeof jQuery!=="undefined")return"jquery";else if(typeof Prototype!=="undefined"&&typeof Effect!=="undefined")return"prototype";else return null};Carousel.getLibraryClass=function(){var e;switch(Carousel.detectUsedLibrary()){case"jquery":e=JQueryCarousel!=undefined?JQueryCarousel:Carousel;break;case"prototype":e=PrototypeCarousel!=undefined?PrototypeCarousel:Carousel;break;default:e=Carousel}return e};Carousel.extend=function(e){if(e==undefined)e=Carousel.getLibraryClass();var t=new e.prototype.constructor;if(t instanceof Carousel==false){e=Carousel.getLibraryClass();t=new e.prototype.constructor}var n=function(){e.prototype.constructor.call(this,arguments);for(attrname in this){if(typeof this[attrname]=="object")this[attrname]=Carousel.clone(this[attrname])}};n.prototype=Carousel.clone(t);n.prototype.constructor=n;n.effects={};for(var r in e.prototype.constructor.effects){n.effects[r]=e.prototype.constructor.effects[r]}return n};Carousel.merge=function(e,t){if(t===undefined)return e;if(typeof e!="object"||e==null||t.tagName!==undefined)return t;for(var n in t){e[n]=Carousel.merge(e[n],t[n])}return e};Carousel.clone=function(e){if(typeof e!="object"||e==null)return e;var t=new e.constructor;for(var n in e)t[n]=Carousel.clone(e[n]);return t};Carousel.effects={};{switch(Carousel.detectUsedLibrary()){case"jquery":$.prototype.extend({setCarousel:function(e,t){return Carousel.create(this[0],e,t)}});break;case"prototype":Element.addMethods({setCarousel:function(e,t,n){return Carousel.create(e,t,n)}});break;default:var isIE7=!window.Element;if(isIE7)Element=function(){};Element.prototype.setCarousel=function(e,t){return Carousel.create(this,e,t)};if(isIE7){var __createElement=document.createElement;document.createElement=function(e){var t=__createElement(e);for(var n in Element.prototype)t[n]=Element.prototype[n];return t};var __getElementById=document.getElementById;document.getElementById=function(e){var t=__getElementById(e);for(var n in Element.prototype)t[n]=Element.prototype[n];return t}}break}}Carousel.prototype={attributes:{changeInProgress:false,container:null,current_shift:0,direction:"forward",effect:null,elements:null,elementsContainer:null,elementsOrdered:{},elementsCount:0,shortcuts:{},thumbnails:{},timer:null,closestLinkAppend:false,baseContainerClass:"carousel_elements"},config:{autostart:true,autorotation:true,widthElement:null,heightElement:null,displayedElement:null,needMask:false,navigation:{type:"shortcut",container:null,label:{previous:"Previous",next:"Next"},thumbnails:{}}},events:{beforenext:new Array,beforeprevious:new Array,change:new Array,init:new Array,aftereffect:new Array},userConfig:{},constructor:Carousel,construct:function(e,t){if(t==undefined)t={};if(typeof e!="object"){alert("Carousel - You must provide a target container");return false}else if(e.nodeName==undefined){alert("Carousel - The target container must be an HTML element");return false}else this.attributes.container=e;if(typeof t.elements!="object"){var n=e.childNodes;t.elements={};for(var r=0;r<n.length;r++){if(n[r].nodeType==1)t.elements[r]=n[r]}}if(t.elements.length==0){alert("Carousel - You must provide an array/object of elements or the container must directly contains the elements");return false}if(typeof t.elements.length!="undefined"){this.attributes.elements={};for(var i=0;i<t.elements.length;i++)this.attributes.elements[i+1]=t.elements[i]}else this.attributes.elements=t.elements;for(var i in this.attributes.elements){if(this.attributes.elements[i].tag==undefined)this.attributes.elements[i]={tag:this.attributes.elements[i]}}if(typeof t=="object"){for(var s in t){switch(s){case"events":for(var o in t[s]){if(this.events[o]!==undefined&&typeof t[s][o]=="function")this.events[o].push(t[s][o])}break;case"effect":this.loadEffect(t[s]);break;default:if(this.config[s]!==undefined)this.config[s]=Carousel.merge(this.config[s],t[s]);else this.userConfig[s]=t[s];break}}}if(this.attributes.effect==null)this.loadEffect();if(this.config.widthElement==null)this.config.widthElement=this.attributes.elements[1].tag.offsetWidth;if(this.config.heightElement==null)this.config.heightElement=this.attributes.elements[1].tag.offsetHeight;if(this.config.displayedElement==null){switch(this.attributes.effect.direction){case"top":case"bottom":this.config.displayedElement=Math.floor(this.attributes.container.offsetHeight/this.config.heightElement);break;case"left":case"right":default:this.config.displayedElement=Math.floor(this.attributes.container.offsetWidth/this.config.widthElement);break}}this._init();if(this.config.autostart){this.config.autorotation=false;this.play()}},_init:function(){if(this.config.needMask){var e=document.createElement("div");e.className="mask";this.attributes.container.appendChild(e)}this.attributes.elementsContainer=document.createElement("div");this.attributes.elementsContainer.className=this.attributes.baseContainerClass;this.attributes.container.appendChild(this.attributes.elementsContainer);if(this.config.navigation.type!==""){if(this.config.navigation.container==null){this.config.navigation.container=document.createElement("div");this.config.navigation.container.className=this.config.navigation.type.replace("|"," ")}if(this.config.navigation.container.parentNode==undefined)this.attributes.container.appendChild(this.config.navigation.container)}for(var t in this.attributes.elements)this._insertElementIntoContainer(t);this._changeElementsOrder();this._setElementsContainerClassName();var n=this.attributes.elementsOrdered[0].getAttribute("id_carousel_element");this._triggerEvent("init",this.attributes.elements[n],this);return this},_insertElementIntoContainer:function(e){var t=document.createElement("div");if(typeof this.attributes.elements[e].tag!="object")t.innerHTML=this.attributes.elements[e].tag;else t.appendChild(this.attributes.elements[e].tag);t.childNodes[0].setAttribute("id_carousel_element",e);this.attributes.elementsContainer.appendChild(t.childNodes[0]);this.attributes.elementsCount++;if(this.config.navigation.type.search("shortcut")!=-1){var n=document.createElement("a");n.href="#";n.innerHTML=e;n.setAttribute("id_carousel_element",e);n.carousel=this;n.onclick=function(){this.carousel.goToElement(this.getAttribute("id_carousel_element"));return false};this.config.navigation.container.appendChild(n);this.attributes.shortcuts[e]=n}if(this.config.navigation.type.search("thumbnail")!=-1){var r=document.createElement("a");r.href="#";if(typeof this.config.navigation.thumbnails[e-1]=="object")r.appendChild(this.config.navigation.thumbnails[e-1]);else if(this.config.navigation.thumbnails[e-1]!=undefined)r.innerHTML=this.config.navigation.thumbnails[e-1];r.setAttribute("id_carousel_element",e);r.carousel=this;r.onclick=function(){this.carousel.goToElement(this.getAttribute("id_carousel_element"));return false};this.config.navigation.container.appendChild(r);this.attributes.thumbnails[e]=r}if(this.config.navigation.type.search("closest")!=-1&&this.attributes.elementsCount>this.config.displayedElement&&!this.attributes.closestLinkAppend){var i=document.createElement("a");i.href="#";i.className="previous";i.innerHTML=this.config.navigation.label.previous;i.carousel=this;i.onclick=function(){this.carousel.previousElement();return false};this.config.navigation.container.appendChild(i);var s=document.createElement("a");s.href="#";s.className="next";s.innerHTML=this.config.navigation.label.next;s.carousel=this;s.onclick=function(){this.carousel.nextElement();return false};this.config.navigation.container.appendChild(s);this.attributes.closestLinkAppend=true}},_loadTimer:function(e){var t=this;if(e!==null&&this.attributes.elementsCount>this.config.displayedElement){if(e>0)this.attributes.timer=window.setTimeout(function(){t.change()},e);else this.change()}return this},_changeElementsOrder:function(){var e=this.attributes.elementsContainer.childNodes,t=0,n=null;this.attributes.elementsOrdered={};if(e.length>0){for(var r=0;r<e.length;r++)this.attributes.elementsOrdered[r]=e[r];t=this.attributes.elementsOrdered[0].getAttribute("id_carousel_element");if(this.config.navigation.type.search("shortcut")!=-1){for(id_carousel_element in this.attributes.shortcuts){n=this.attributes.shortcuts[id_carousel_element];n.className=n.className.replace("current","");if(id_carousel_element==t)n.className=n.className+" current"}}if(this.config.navigation.type.search("thumbnails")!=-1){for(id_carousel_element in this.attributes.thumbnails){n=this.attributes.thumbnails[id_carousel_element];n.className=n.className.replace("current","");if(id_carousel_element==t)n.className=n.className+" current"}}this._triggerEvent("change",this.attributes.elements[t])}return this},_changeActiveElement:function(e,t){var n=false;if(t==undefined)t=true;window.clearTimeout(this.attributes.timer);this.attributes.effect.resetPosition();for(i in this.attributes.elementsOrdered){if(!n&&this.attributes.elementsOrdered[i].getAttribute("id_carousel_element")!=e)this.attributes.elementsOrdered[i].parentNode.appendChild(this.attributes.elementsOrdered[i]);else if(this.attributes.elementsOrdered[i].getAttribute("id_carousel_element")==e)n=true;this.attributes.elementsOrdered[i].style.display=""}this._changeElementsOrder();if(this.config.autorotation&&t)this._loadTimer(this.attributes.effect.config.pause);return this},_triggerEvent:function(){var e=Array.prototype.slice.call(arguments);var t=e.shift();if(this.events[t]!=undefined){for(var n=0;n<this.events[t].length;n++)this.events[t][n].apply(this,e)}return this},_checkEffectValidity:function(){return this.attributes.effect!==null},_setElementsContainerClassName:function(){if(this.attributes.elementsContainer!==null)this.attributes.elementsContainer.className=this.attributes.baseContainerClass+" "+this.attributes.effect.getClass()},loadEffect:function(e){if(typeof e!="object"){e={type:"base",params:{}}}var t=false;for(var n in this.constructor.effects){if(e.type.toLowerCase()==n.toString().toLowerCase()){var r=new this.constructor.effects[n];r.link(this,e.params);if(this.attributes.effect!=null&&this.attributes.effect.inProgress){$carousel=this;this.events.aftereffect.push(function(){$carousel.attributes.effect=r;$carousel.events.aftereffect.pop()})}else this.attributes.effect=r;this._setElementsContainerClassName();t=true}}if(!t)alert("Carousel - this.attributes.effect ("+e.type+") is not available");return this},change:function(){window.clearTimeout(this.attributes.timer);this._setElementsContainerClassName();this.attributes.effect.update()},goToNext:function(e){var t;if(this.attributes.direction=="forward")t=this.attributes.elementsOrdered[1].getAttribute("id_carousel_element");else t=this.attributes.elementsOrdered[this.attributes.elementsCount-1].getAttribute("id_carousel_element");return this._changeActiveElement(t,e)},goToElement:function(e){var t=this,n=this.attributes.elementsOrdered,r=n[0].getAttribute("id_carousel_element"),i=new Array,s=this.attributes.elementsContainer.childNodes,o=0;if(r!=e&&!this.attributes.effect.inProgress){this.attributes.elementsOrdered={};for(var u=0;u<s.length;u++){if(s[u].getAttribute("id_carousel_element")==e){if(this.attributes.direction=="forward")i[1]=s[u];else i[s.length]=s[u]}else{if(this.attributes.direction=="forward"&o==1)o++;i[o++]=s[u]}}for(var u=0;u<i.length;u++){this.attributes.elementsOrdered[u]=i[u];this.attributes.elementsContainer.appendChild(i[u])}this.events.aftereffect.push(function(){t.events.aftereffect.pop();t.attributes.elementsOrdered=n;for(var r in n)this.attributes.elementsContainer.appendChild(n[r]);t._changeActiveElement(e)});this.change()}return this},changeDirection:function(e){this.attributes.direction=e;return this},nextElement:function(){this._triggerEvent("beforenext");if(this.attributes.elementsCount>this.config.displayedElement&&!this.attributes.effect.inProgress){this.attributes.effect.prepareNextElement();this.change()}return this},previousElement:function(){this._triggerEvent("beforenprevious");if(this.attributes.elementsCount>this.config.displayedElement&&!this.attributes.effect.inProgress){this.attributes.effect.preparePreviousElement();this.change()}return this},stop:function(){this.config.autorotation=false;if(!this.attributes.effect.inProgress)window.clearTimeout(this.attributes.timer);return this},play:function(){if(!this.config.autorotation){this.config.autorotation=true;window.clearTimeout(this.attributes.timer);this._loadTimer(this.attributes.effect.config.pause)}return this}};Carousel.effects.Base=function(){};Carousel.effects.Base.extend=function(e,t,n){if(n==undefined)n=Carousel.effects.Base;if(e==undefined)e={};if(t==undefined)t={};var r=new n.prototype.constructor;if(r instanceof Carousel.effects.Base==false){n=Carousel.effects.Base;r=new n.prototype.constructor}var i=function(){n.prototype.constructor.call(this,arguments);for(attrname in this){if(typeof this[attrname]=="object")this[attrname]=Carousel.clone(this[attrname])}};i.prototype=Carousel.clone(r);i.prototype.constructor=i;Carousel.merge(i.prototype.config,e);Carousel.merge(i.prototype.attributes,t);return i};Carousel.effects.Base.prototype={carousel:null,inProgress:false,config:{pause:4e3},attributes:{name:"Base"},constructor:Carousel.effects.Base,link:function(e,t){this.carousel=e;Carousel.merge(this.config,t)},update:function(){var e=this.carousel;e.goToNext();var t=e.attributes.elementsOrdered[0].getAttribute("id_carousel_element");e._triggerEvent("aftereffect",e.attributes.elements[t])},move:function(){},resetPosition:function(){},preparePreviousElement:function(){var e=this.carousel;e.changeDirection("backward");e.events.change.push(function(){e.changeDirection("forward");e.events.change.pop()})},prepareNextElement:function(){},getClass:function(){return"effect-"+this.attributes.name.toLowerCase()}};Carousel.effects.Slide=Carousel.effects.Base.extend({direction:"left",duration:500},{name:"slide",current_shift:0,tempo:20});Carousel.effects.Slide.prototype.update=function(){var e=this.attributes.tempo,t=this.carousel;if(!this.inProgress){if(this.config.direction=="right"||this.config.direction=="bottom"){t.changeDirection("backward");t.goToNext(false);this.move()}else t.changeDirection("forward")}this.inProgress=true;this.attributes.current_shift=this._getUnitShift();this.move();if(this.attributes.current_shift<0||this.attributes.current_shift>this._getMaxDimension()){if(this.config.direction=="left"||this.config.direction=="top")t.goToNext(false);else this.resetPosition();this.inProgress=false;var n=t.attributes.elementsOrdered[0].getAttribute("id_carousel_element");t._triggerEvent("aftereffect",t.attributes.elements[n]);e=t.config.autorotation?this.config.pause:null}t._loadTimer(e)};Carousel.effects.Slide.prototype.move=function(){var e=this.carousel,t=e.attributes.elementsOrdered[0].style,n=this.attributes.current_shift;switch(this.config.direction){case"left":t.marginLeft=n*-1+"px";break;case"right":t.marginLeft=(this._getMaxDimension()-n)*-1+"px";break;case"top":t.marginTop=n*-1+"px";break;case"bottom":t.marginTop=(this._getMaxDimension()-n)*-1+"px";break}return this};Carousel.effects.Slide.prototype.preparePreviousElement=function(){var e=this.carousel;this.invertDirection();e.events.aftereffect.push(function(){e.attributes.effect.invertDirection();e.events.aftereffect.pop()})};Carousel.effects.Slide.prototype._getUnitShift=function(){var e=this.config.duration/this.attributes.tempo,t=this._getMaxDimension()/e;return parseInt(this.attributes.current_shift)+t};Carousel.effects.Slide.prototype._getMaxDimension=function(){var e=this.carousel;switch(this.config.direction){case"left":case"right":return e.config.widthElement;break;case"top":case"bottom":return e.config.heightElement;break}};Carousel.effects.Slide.prototype.invertDirection=function(){var e;switch(this.config.direction){case"top":e="bottom";break;case"right":e="left";break;case"bottom":e="top";break;case"left":e="right";break}this.config.direction=e;return this};Carousel.effects.Slide.prototype.resetPosition=function(){var e=this.carousel;for(i in e.attributes.elementsOrdered){var t=e.attributes.elementsOrdered[i].style;t.marginTop=t.marginRight=t.marginBottom=t.marginLeft="0px"}this.attributes.current_shift=0};Carousel.effects.Slide.prototype.getClass=function(){var e="horizontal",t=Carousel.effects.Base.prototype.getClass.apply(this,arguments);switch(this.config.direction){case"top":case"bottom":e="vertical";break}return t+" effect-"+e+"-move"};Carousel.effects.Swing=Carousel.effects.Base.extend({},{name:"swing",firstPart:true},Carousel.effects.Slide);Carousel.effects.Swing.prototype.link=function(){Carousel.effects.Slide.prototype.link.apply(this,arguments);this.attributes.tempo=this.attributes.tempo/2};Carousel.effects.Swing.prototype.update=function(){var e=this.carousel,t=this.attributes.tempo;this.inProgress=true;this.attributes.current_shift=this._getUnitShift();this.move();if(this.attributes.current_shift<0||this.attributes.current_shift>this._getMaxDimension()){if(this.attributes.firstPart){e.goToNext(false);this.attributes.current_shift=this._getMaxDimension();this.move();this.attributes.current_shift=0}else{this.resetPosition();this.inProgress=false;var n=e.attributes.elementsOrdered[0].getAttribute("id_carousel_element");e._triggerEvent("aftereffect",e.attributes.elements[n]);t=e.config.autorotation?this.config.pause:null}this.invertDirection();this.attributes.firstPart=!this.attributes.firstPart}e._loadTimer(t)};Carousel.effects.Swing.prototype.move=function(){var e=this.carousel,t=e.attributes.elementsOrdered[0].style,n=this.attributes.current_shift;switch(this.config.direction){case"left":if(this.attributes.firstPart){t.marginLeft=n*-1+"px";t.marginRight=n+"px"}else t.marginLeft=this._getMaxDimension()-n+"px";break;case"right":if(!this.attributes.firstPart){n=this._getMaxDimension()-n;t.marginLeft=n*-1+"px";t.marginRight=n+"px"}else t.marginLeft=n+"px";break;case"top":if(this.attributes.firstPart){t.marginTop=n*-1+"px";t.marginBottom=n+"px"}else t.marginBottom=n+"px";break;case"bottom":if(!this.attributes.firstPart){n=this._getMaxDimension()-n;t.marginTop=n*-1+"px";t.marginBottom=n+"px"}else t.marginBottom=n+"px";break}return this};Carousel.effects.Swing.prototype.preparePreviousElement=function(){Carousel.effects.Base.prototype.preparePreviousElement.apply(this,arguments)};Carousel.effects.SlideHover=Carousel.effects.Base.extend({},{name:"slide-hover"},Carousel.effects.Slide);Carousel.effects.SlideHover.prototype.move=function(){var e=this.carousel,t=e.attributes.elementsOrdered[0].style,n=e.attributes.elementsOrdered[1].style,r=this.attributes.current_shift;switch(this.config.direction){case"left":t.position=n.position="";t.marginRight=r*-1+"px";break;case"right":t.marginLeft=(this._getMaxDimension()-r)*-1+"px";t.marginRight=r*-1+"px";t.position="relative";n.position="relative";t.zIndex=1;n.zIndex=0;break;case"top":t.position=n.position="";t.marginBottom=r*-1+"px";break;case"bottom":t.marginTop=(this._getMaxDimension()-r)*-1+"px";t.marginBottom=r*-1+"px";t.position="relative";n.position="relative";t.zIndex=1;n.zIndex=0;break}return this};var JQueryCarousel=Carousel.extend();JQueryCarousel.effects.Fade=Carousel.effects.Base.extend({duration:500},{name:"fade"});JQueryCarousel.effects.Fade.prototype.link=function(){Carousel.effects.Base.prototype.link.apply(this,arguments);this.config.duration=this.config.duration/2};JQueryCarousel.effects.Fade.prototype.update=function(){var e=this.carousel,t=this;this.inProgress=true;$(e.attributes.elementsOrdered[0]).fadeOut(this.config.duration,function(){t._endUpdate()});return this};JQueryCarousel.effects.Fade.prototype._endUpdate=function(){var e=this.carousel,t=this;e.goToNext();e.attributes.elementsOrdered[0].style.display="none";$(e.attributes.elementsOrdered[0]).fadeIn(this.config.duration,function(){t.inProgress=false;var n=e.attributes.elementsOrdered[0].getAttribute("id_carousel_element");e._triggerEvent("aftereffect",e.attributes.elements[n])});return this};JQueryCarousel.effects.FadeHover=Carousel.effects.Base.extend({duration:500},{name:"fade-hover"});JQueryCarousel.effects.FadeHover.prototype.update=function(){var e=this.carousel,t=this,n=e.attributes.elementsOrdered[0],r=null,i=e.config.autorotation?this.config.pause:null;this.inProgress=true;n.style.position="absolute";n.style.left="0px";n.style.top="0px";$(n).fadeOut(this.config.duration);e.goToNext(false);r=e.attributes.elementsOrdered[0];r.style.display="none";$(r).fadeIn(this.config.duration,function(){n.style.position="";e._loadTimer(i);t.inProgress=false;var r=n.getAttribute("id_carousel_element");e._triggerEvent("aftereffect",e.attributes.elements[r])});return this};var PrototypeCarousel=Carousel.extend();PrototypeCarousel.effects.Fade=Carousel.effects.Base.extend({duration:500},{name:"fade"});PrototypeCarousel.effects.Fade.prototype.link=function(){Carousel.effects.Base.prototype.link.apply(this,arguments);this.config.duration=this.config.duration/2e3};PrototypeCarousel.effects.Fade.prototype.update=function(){var e=this.carousel,t=this;this.inProgress=true;var n={duration:this.config.duration,from:1,to:0,afterFinish:function(){t._endUpdate()}};new Effect.Opacity(e.attributes.elementsOrdered[0],n);return this};PrototypeCarousel.effects.Fade.prototype._endUpdate=function(){var e=this.carousel,t=this;e.goToNext();var n={duration:this.config.duration,from:0,to:1,afterFinish:function(){t.inProgress=false;var n=e.attributes.elementsOrdered[0].getAttribute("id_carousel_element");e._triggerEvent("aftereffect",e.attributes.elements[n])}};new Effect.Opacity(e.attributes.elementsOrdered[0],n);return this};PrototypeCarousel.effects.FadeHover=Carousel.effects.Base.extend({duration:500},{name:"fade-hover"});PrototypeCarousel.effects.FadeHover.prototype.link=function(){Carousel.effects.Base.prototype.link.apply(this,arguments);this.config.duration=this.config.duration/1e3};PrototypeCarousel.effects.FadeHover.prototype.update=function(){var e=this.carousel,t=this,n=e.attributes.elementsOrdered[0],r=null,i={duration:this.config.duration,from:1,to:0},s={duration:this.config.duration,from:0,to:1};time=e.config.autorotation?this.config.pause:null;this.inProgress=true;n.style.position="absolute";n.style.left="0px";n.style.top="0px";new Effect.Opacity(n,i);e.goToNext(false);r=e.attributes.elementsOrdered[0];s.afterFinish=function(){n.style.position="";e._loadTimer(time);t.inProgress=false;var r=n.getAttribute("id_carousel_element");e._triggerEvent("aftereffect",e.attributes.elements[r])};new Effect.Opacity(r,s);return this}